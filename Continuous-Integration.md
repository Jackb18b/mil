The Continuous Integration (CI) service for MIL projects is a self-hosted [Jenkins](https://jenkins.io/index.html) server with a [Docker](https://www.docker.com) backend. MIL had been using [Semaphore](https://semaphoreci.com) before the upgrade to Ubuntu 16.04 and ROS Kinetic. Due to this new software stack not being supported on that platform, and after considering other available services, it was decided to self-host the CI infrastructure for increased performance and configurability. This page is meant to provide an overview of the way that the service was configured and why certain design decisions were made. If you have any questions that are not answered on this page, feel free to contact [Anthony Olive](https://github.com/whispercoros) with any further questions.

# Docker
Docker is the platform that is used to provision hosts for each build. It enables the creation of an image based on a Docker build file that can contain eenvironment variables, commands to run, external volume configurations, and more. The filesystem for this image is built in layers of differences using aurfs. For more information on how Docker works and how to use it, please refer to the project's [website](https://www.docker.com).

#### Design Decision
Docker was chosen for a few different reasons. Most importantly, it allows us to spin up ephemeral containers. This means that a container can be quickly created based on the image for a project and then that container can be torn down once the build process for a pull request or branch is complete. For each container, a new filesystem layer is created on top of the image to temporarily store changes, such as compiled code. After the build, that layer is simply discarded. This system also enables us to spin up multiple containers at once on top of the same image, meaning we are not limited to just one build at a time (this would be the case with a free subscription to an online CI service). Last but not least, since all of the dependencies are fetched when an image is created, builds will be much faster.

#### Implementation
The [Docker Slaves Plugin](https://wiki.jenkins-ci.org/display/JENKINS/Docker+Slaves+Plugin) is used to connect Jenkins to Docker. This plugin requires that the `jenkinsci/slave:latest` image is present for running commands inside the Docker slave and that the `buildpack-deps:scm` image is present for checking out the required Git commit. 

See the [example](https://github.com/uf-mil/mil_common/blob/master/scripts/Dockerfile) in this repository for information on how build files should be formatted. The file is well commented and should be fairly self explanatory so long as you understand Docker. The location that the build file for a project should be stored is `scripts/Dockerfile` relative to the repository's root directory.